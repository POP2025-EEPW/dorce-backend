// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

Table users {
  id UUID [primary key]
  username varchar
  password varchar
  authToken varchar 
  roles smallint[]
}

Table catalogs {
  id UUID [primary key]
  description varchar
  title varchar
  issued date
  modified date
  parent_id uuid
}

Table datasets {
  id UUID [primary key]
  title varchar
  description varchar
  quality_controllable boolean
  owner_id UUID [ref: - users.id]
  schema_id UUID [ref: - schemas.id]
  status varchar [note: 'Enum: DRAFT, SUBMITTED, ACTIVE, DELETED']
  quality_tag varchar
}

Table catalogs_datasets {
  catalog_id UUID [ref: - catalogs.id]
  datasets_id UUID [ref: - datasets.id]
}

Table schemas {
  id UUID [primary key]
  title varchar
  description varchar
}

Table comments {
  id UUID [primary key]
  content varchar
  dataset_id UUID [ref: > datasets.id]
}

Table raw_datasets {
  id UUID [primary key]
  dataset_id UUID [unique, ref: - datasets.id]
  resource_uri varchar
  registered_at timestamp
}

Table data_entries {
  id UUID [primary key]
  dataset_id UUID [ref: > datasets.id]
  content text
  suspicious boolean
  erroneous boolean
  created_at timestamp
  updated_at timestamp
}

Table quality_validity_alerts {
  id UUID [primary key]
  dataset_id UUID [ref: > datasets.id]
  alert_type varchar [note: 'SUSPICIOUS_ENTRY, ERRONEOUS_ENTRY, QUALITY_TAG_SET']
  message text
  severity varchar [note: 'LOW, MEDIUM, HIGH']
  resolved boolean
  created_at timestamp
}

Table raw_data_batches {
  id UUID [primary key]
  raw_dataset_id UUID [ref: > raw_datasets.id]
  storage_reference varchar
  batch_name varchar
  data_url text
  size_in_bytes bigint
  entry_count integer
  appended_at timestamp
}

Table concepts {
  id UUID [primary key, ref: - types.id]
  schema_id UUID [ref: > schemas.id]
}

Table primitive_types {
  id UUID [primary key, ref: - types.id]
}

Table constraints {
  id UUID [primary key]
  rule varchar
  schema_id UUID [ref: > schemas.id]
}

Table types {
  id UUID [primary key]
  name varchar
}

Table properties {
  id UUID [primary key]
  name varchar
  concept_id UUID [ref : > concepts.id]
  type_id UUID [ref: > types.id]
}
