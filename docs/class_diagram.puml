@startuml
skinparam classAttributeIconSize 0
class SecurityConfig{
- userService : UserService
+ SecurityConfig(userService : UserService)
+ authFilter() : AuthFilter
+ filterChain(http : HttpSecurity) : SecurityFilterChain
}
class AuthService{
userRepository : UserRepository
+ AuthService(userRepository : UserRepository)
+ authUser(request : AuthRequest) : String
}
class DatasetController{
- datasetService : DatasetService
+ addDataset(dataset : DatasetCreationRequest) : ResponseEntity<?>
+ getDataset(id : UUID) : ResponseEntity<?>
+ editDataset(id : UUID, dataset : DatasetEditionRequest) : ResponseEntity<?>
+ getDatasetDescription(id : UUID) : ResponseEntity<?>
+ listDatasets(title : String, page : Integer, pageSize : Integer) : ResponseEntity<?>
+ listOwnedDatasets(userId : UUID) : ResponseEntity<?>
+ getQualityControllableDatasets() : ResponseEntity<?>
+ setDataSchema(id : UUID, schema : Schema) : ResponseEntity<?>
+ submitDataset(id : UUID) : ResponseEntity<?>
+ publishDataset(id : UUID) : ResponseEntity<?>
+ archiveDataset(id : UUID) : ResponseEntity<?>
+ registerRawDataset(datasetId : UUID, request : RegisterRawDatasetRequest) : ResponseEntity<?>
+ getRawDataset(datasetId : UUID) : ResponseEntity<?>
+ appendRawBatch(datasetId : UUID, request : AppendBatchRequest) : ResponseEntity<?>
+ listRawBatches(datasetId : UUID, pageable : Pageable) : ResponseEntity<?>
}
class AddCatalogRequest{
- parentCatalogId : UUID
- catalog : CatalogDto
}
class DatasetCreationRequest{
- title : String
- description : String
- qualityControllable : Boolean
- schemaId : UUID
}
class DatasetEditionRequest{
- title : String
- description : String
}
class DatasetFilter{
- title : String
}
class DatsetDescription{
- description : String
}
class DatasetSummary{
- id : UUID
- title : String
- description : String
}
class ResourceNotFoundException{
+ ResourceNotFoundException(message : String)
}
ResourceNotFoundException --|> RuntimeException

class InvalidDatasetStatusException{
+ InvalidDatasetStatusException(message : String)
}
InvalidDatasetStatusException --|> RuntimeException

class AuthFilter{
- userService : UserService
+ AuthFilter(userService : UserService)
# doFilterInternal(request : HttpServletRequest, response : HttpServletResponse, filterChain : FilterChain) : void
}
AuthFilter --|> OncePerRequestFilter
class DatasetService{
- datasetRepository : DatasetRepository
- userService : UserService
- rawDatasetRepository : RawDatasetRepository
- rawDataBatchRepository : RawDataBatchRepository
- schemaRepository : SchemaRepository
+ addDataset(dataser: DatasetCreationRequest, authToken AuthToken, qualityControllable : Boolean) : Dataset
+ DatasetService(datasetRepository : DatasetRepository)
+ getDataset(id : UUID) : Dataset
+ addDataset(dataset : DatasetCreationRequest) : Dataset
+ editDataset(id : UUID, dataset : DatasetEditionRequest)
+ getDatasetDescription(id : UUID) : String
+ listDatasets(filter : DatasetFilter, page : Integer, pageSize : Integer) : List<DatasetSummary>
+ listOwneredDatasets(userId : UUID) : List<DatasetSummary>
+ getQualityControllableDatasets() : List<DatasetSummary>
+ setDataSchema(datasetId : UUID, schemaId : UUID) : Dataset
+ submitDataset(id : UUID) : Dataset
+ publishDataset(id : UUID) : Dataset
+ archiveDataset(id : UUID) : Dataset
+ registerRawDataset(datasetId : UUID, request : RegisterRawDatasetRequest) : RawDataset
+ getRawDatasetByDatasetId(datasetId : UUID) : RawDataset
+ appendRawBatch(datasetId : UUID, request : AppendBatchRequest) : RawDataBatch
+ listRawBatches(datasetId : UUID, pageable : Pageable) : Page<RawDataBatch>
}

class CatalogController{
catalogService : CatalogService
datasetService : DatasetService
+ addCatalog(request : AddCatalogRequest) : ResponseEntity<?>
+ listCatalogs(parentCatalogId : UUID) : ResponseEntity<?>
+ getCatalog(catalogId : UUID) : ResponseEntity<?>
+ getCatalogDatasets(catalogId : UUID, page : Integer, pageSize : Integer) : ResponseEntity<?>
}

class Dataset{
- id : UUID
- title : String
- description : String
- owner : User
- qualityControllable : Boolean
- schema : Schema
- status : DatasetStatus
- qualityTag : String
+ Dataset()
+ Dataset(title : String, description : String, owner : User, qualityControllable : Boolean, schema : Schema)
}

enum DatasetStatus {
DRAFT
SUBMITTED
ACTIVE
DELETED
}

class Comment{
- id : UUID
- content : String
- dataset : Dataset
+ Comment()
+ Comment(content : String, dataset : Dataset)
}
class CommentController{
- commentService : CommentService
+ addDatasetComment(datasetId : UUID, content : String) : ResponseEntity<?>
}
class CommentService{
- commentRepository : CommentRepository
+ CommentService(commentRepository : CommentRepository)
+ addDatasetcomment(datasetId : UUID, content : String) : Comment
}
class Schema{
- id : UUID
+ Schema()
}
class addDatasetCommentRequest{
- content : String
- datasetId : UUID
}
class UserService{
- userRepository : UserRepository
+ UserService(userRepository : UserRepository)
- generateAuthToken() : String
+ registerNewUser(request : UserRegistrationRequest) : User
+ getUserByAuthToken(authToken : String) : User
}
class DorceApplication{
- testRepository : TestRepository
home() : String
+ {static} main(args : String[]) : void
}
class CatalogService{
- catalogRepository : CatalogRepository
+ addCatalog(parentCatalogId : UUID, catalog : Catalog) : Catalog
+ getCatalog(catalogId : UUID) : Catalog
+ listCatalogs(parentCatalogId : UUID) : List<Catalog>
+ listCatalogDatasets(catalogId : UUID, page : Integer, pageSize : Integer) : List<Dataset>
}
class UserRegistrationRequest{
- username : String
- password : String
- roles : List<Role>
}
class AuthController{
authService : AuthService
+ authUser(request : AuthRequest) : ResponseEntity<?>
}
class AuthRequest{
- username : String
- password : String
}
class UserController{
userService : UserService
+ registerUser(request : UserRegistrationRequest) : ResponseEntity<?>
}
class OpenApiConfig{
}
class User{
- id : UUID
- username : String
- password : String
- authToken : String
- roles : List<Role>
+ User()
+ User(username : String, password : String, roles : List<Role>, authToken : String)
}
class Test{
- id : UUID
+ name : String
+ Test(name : String)
+ Test()
}
class Catalog{
- id : UUID
- description : String
- title : String
- issued : LocalDateTime
- modified : LocalDateTime
- parent : Catalog
- catalogs : List<Catalog>
- datasets : List<Dataset>
}
class CatalogDto{
- description : String
- title : String
- datasets : List<UUID>
}

class RawDataset {
- id : UUID
- dataset : Dataset
- resourceUri : String
- registeredAt : LocalDateTime
- batches : List<RawDataBatch>
}

class RawDataBatch {
- id : UUID
- rawDataset : RawDataset
- storageReference : String
- batchName : String
- sizeInBytes : Long
- entryCount : Integer
- appendedAt : LocalDateTime
}

class RegisterRawDatasetRequest {
- dataUrl : String
}

class AppendBatchRequest {
- storageReference : String
- batchName : String
- sizeInBytes : Long
- entryCount : Integer
}

interface RawDatasetRepository{
+ findByDatasetId(datasetId : UUID) : Optional<RawDataset>
}
RawDatasetRepository --|> JpaRepository

interface RawDataBatchRepository{
+ findByRawDatasetId(rawDatasetId : UUID, pageable : Pageable) : Page<RawDataBatch>
}
RawDataBatchRepository --|> JpaRepository

class QualityManagementController {
- qualityManagementService : QualityManagementService
+ markDataEntrySuspicious(entryId : UUID) : ResponseEntity<?>
+ markDataEntryErroneous(entryId : UUID) : ResponseEntity<?>
+ getRawDownloadLink(datasetId : UUID) : ResponseEntity<?>
+ checkRawAvailability(datasetId : UUID) : ResponseEntity<?>
+ setQualityTag(datasetId : UUID, request : SetQualityTagRequest) : ResponseEntity<?>
+ listQualityValidityAlerts(datasetId : UUID, unresolvedOnly : Boolean) : ResponseEntity<?>
+ listRawBatches(datasetId : UUID) : ResponseEntity<?>
}

class QualityManagementService {
- dataEntryRepository : DataEntryRepository
- datasetService : DatasetService
- alertRepository : QualityValidityAlertRepository
- rawDataBatchRepository : RawDataBatchRepository
- rawDatasetRepository : RawDatasetRepository
+ markDataEntrySuspicious(entryId : UUID) : void
+ markDataEntryErroneous(entryId : UUID) : void
+ getRawDownloadLink(datasetId : UUID) : String
+ checkRawAvailability(datasetId : UUID) : RawDataAvailabilityResponse
+ setQualityTag(datasetId : UUID, qualityTag : String) : void
+ listQualityValidityAlerts(...) : List<QualityValidityAlertResponse>
+ listRawBatches(datasetId : UUID) : List<RawDataBatchResponse>
}

class DataEntry {
- id : UUID
- dataset : Dataset
- content : String
- suspicious : Boolean
- erroneous : Boolean
- createdAt : LocalDateTime
- updatedAt : LocalDateTime
}

class QualityValidityAlert {
- id : UUID
- dataset : Dataset
- alertType : String
- message : String
- severity : String
- createdAt : LocalDateTime
- resolved : Boolean
}

class SetQualityTagRequest {
- qualityTag : String
}

class RawDataAvailabilityResponse {
- available : Boolean
- url : String
}

class QualityValidityAlertResponse {
- id : UUID
- datasetId : UUID
- datasetTitle : String
- alertType : String
- message : String
- severity : String
- resolved : Boolean
}

class RawDataBatchResponse {
- id : UUID
- batchName : String
- storageReference : String
- dataUrl : String
- sizeInBytes : Long
- uploadedAt : LocalDateTime
}

interface DataEntryRepository {}
DataEntryRepository --|> JpaRepository

interface QualityValidityAlertRepository {}
QualityValidityAlertRepository --|> JpaRepository


SecurityConfig--"- userService" UserService
AuthService--"userRepository" UserRepository
DatasetController--"- datasetService" DatasetService
AddCatalogRequest--"- catalog" CatalogDto
AuthFilter--"- userService" UserService
DatasetService--"- datasetRepository" DatasetRepository
CatalogController--"catalogService" CatalogService
CatalogController--"datasetService" DatasetService
UserService--"- userRepository" UserRepository
DorceApplication--"- testRepository" TestRepository
CatalogService--"- catalogRepository" CatalogRepository
AuthController--"authService" AuthService
UserController--"userService" UserService
Catalog--"- parent" Catalog
CommentController--"- commentService" CommentService
CommentService--"- commentRepository" CommentRepository
Comment --"- dataset" Dataset
Dataset --"- schema" Schema
Dataset --"- owner" User
Dataset --"- parent" Catalog
DatasetService --"- rawDatasetRepository" RawDatasetRepository
DatasetService --"- rawDataBatchRepository" RawDataBatchRepository
Dataset *-- DatasetStatus
RawDataset -- "dataset" Dataset : 1:1
RawDataBatch -- "rawDataset" RawDataset : N:1
QualityManagementController --"- qualityManagementService" QualityManagementService
QualityManagementService --"- dataEntryRepository" DataEntryRepository
QualityManagementService --"- datasetService" DatasetService
QualityManagementService --"- alertRepository" QualityValidityAlertRepository
QualityManagementService --"- rawDataBatchRepository" RawDataBatchRepository
QualityManagementService --"- rawDatasetRepository" RawDatasetRepository
DataEntry --"- dataset" Dataset
QualityValidityAlert --"- dataset" Dataset
QualityManagementController ..> SetQualityTagRequest
QualityManagementService ..> RawDataAvailabilityResponse
QualityManagementService ..> QualityValidityAlertResponse
QualityManagementService ..> RawDataBatchResponse

interface CatalogRepository{
findAllByParentIsNull() : List<Catalog>
findAllByParent(parent : Catalog) : List<Catalog>
}
CatalogRepository --|> JpaRepository
interface UserRepository{
findByUsername(username : String) : User
findByAuthToken(authToken : String) : User
}
UserRepository --|> JpaRepository
interface DatasetRepository{
+ findByOwner(user : Owner) : List<Dataset>
}
DatasetRepository --|> JpaRepository
interface TestRepository{
+ findQualityControllableTrue() : List<Dataset>
}
TestRepository --|> JpaRepository
interface CommentRepository{
}
CommentRepository --|> JpaRepository
interface SchemaRepository{
+ findByIdEquals(id : UUID) : Schema
}
SchemaRepository --|> JpaRepository
enum Role{
MetadataManager
AcquisitionAppManager
DataQualityManager
DataSupplier
DataUser
AccessAppDeveloper
Admin
}

note right of QualityManagementController
  **REST Endpoints:**
  POST /api/quality/entries/{entryId}/mark-suspicious
  POST /api/quality/entries/{entryId}/mark-erroneous
  GET /api/quality/datasets/{datasetId}/raw-download-link
  GET /api/quality/datasets/{datasetId}/raw-availability
  PUT /api/quality/datasets/{datasetId}/quality-tag
  GET /api/quality/alerts
end note

note right of DataEntry
  **Quality Flags:**
  - suspicious: marked via markDataEntrySuspicious()
  - erroneous: marked via markDataEntryErroneous()
  Both trigger alert creation
end note

note right of QualityValidityAlert
  **Alert Types:**
  - SUSPICIOUS_ENTRY (MEDIUM)
  - ERRONEOUS_ENTRY (HIGH)
  - QUALITY_TAG_SET (LOW)
end note

note right of Dataset
  **Group 5 Fields:**
  - qualityTag: set via setQualityTag()
  - rawDataUrl: accessed via getRawDownloadLink()
  - rawDataAvailable: checked via checkRawAvailability()
end note

@enduml